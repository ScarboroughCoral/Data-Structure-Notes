## 简单计算机网络





### 应用层

#### HTTP

##### 常见状态码





#### DHCP

> 从DHCP服务器动态获取IP、子网掩码、默认网关、IP等

##### 过程

1. 主机广播`DHCP Discover`报文
2. DHCP服务器通过`DHCP offer`报文进行响应（带IP等）
3. 主机选择一个DHCP服务器的报文，发起`DHCP Request`报文，请求IP等
4. DHCP服务器分配IP，发起`DHCP ACK`报文



#### NAT

> 最初目的解决IPv4短缺问题

##### 过程

1. 替换：局域网私有IP访问外界时，用{真IP,新端口}替换{私有IP,源端口}
2. 记录：将①中的替换关系记录到NAT转换表
3. 替换：外界网络响应内部IP时：用NAT转换表条目替换回来

##### 一般情景

- 局域网
- 反向代理



##### 实现NAT穿透方法

- 静态配置
- 利用UPnP互联网网关设备协议IGD动态获取
- 中继：中继服务器和两个通信主机建立连接，起到桥接作用

#### DNS

> 映射域名和IP，多对多关系

##### 常用记录类型

- A：域名->IP
- CNAME：域名->域名
- NS：子域名->域名服务器



### 传输层

#### TCP

##### 三次握手

1. 客户端：SYN=1，seq=x（同步，客户端说明自己的初始序列号，不携带数据但消耗一个字节序号，如第2步ack=x+1）
2. 服务端：SYN=1，seq=y（同步，服务端说明自己的初始序列号）；ACK=1，ack=x+1（服务端响应客户端，下一次期望收到的报文序号，不携带数据但消耗一个字节序号）
3. 客户端：ACK=1，ack=y+1（可以携带数据，不携带则不消耗序号）

##### 四次挥手

1. 客户端：FIN=1，seq=u（不携带数据 ，但消耗一个字节序号，**客户端无法再发送数据**）
2. 服务端：ACK=1，seq=v，ack=u+1（服务端响应客户端的FIN，客户端接收到则客户端到服务端的连接关闭）
3. 服务端：传送数据；FIN=1，seq=w；ACK=1，ack=u+1（服务端如果有剩余数据则发送，没有则请求断开）
4. 客户端：ACK=1，seq=u+1，ack=w+1（客户端收到服务端的FIN，等待2MSL时间后断开）



##### 流量控制

> 为了避免接收方缓存区被淹没

- 通过RcvWindow头部字段告知发送方
- RcvWindow表示可用的缓存区大小
- RcvWindow=RcvBuffer-[LastByteRcved-LastByteRead]
- RcvWindow为0时也要发送较少的报文段，为了让数据继续传送，否则可能停止

##### 拥塞控制

> 为了避免网络核心的拥塞现象。发送方窗口大小由接收方流量窗口大小和拥塞窗口大小同时决定

- CongWin<threshold:指数增长
- CongWin>=threshold:加性增
- 3个重复ACK：CongWin/=2,threshold=CongWin
- timeout：Threshold=CongWin/2,CongWin=1MSS
- 重传事件：timeout或者3次冗余ACK，只重传未收到ACK的最小序列号的数据



### 网络层

#### IP

##### 私有IP

| 类名 |             网络号              | 网络数 |
| :--: | :-----------------------------: | :----: |
| A类  |           10.0.0.0/8            |   1    |
| B类  |   172.16.0.0/16-172.31.0.0/16   |   16   |
| C类  | 192.168.0.0/24-192.168.255.0/24 |  256   |



### 链路层

> 实现链路网络两端（通信物理链路两端）的通信，一般是以太网协议



### 整体过程——校园网访问Baidu

![1570769092638](pics/1570769092638.png)